(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-detail"],{"7fb3":function(t,e,a){"use strict";a.r(e);var n=a("9585"),i=a.n(n);for(var o in n)"default"!==o&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a},"84fd":function(t,e,a){"use strict";var n;a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){return n}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"chatContext"},[a("v-uni-view",{staticClass:"chatBox"},t._l(t.messages,(function(e){return a("v-uni-view",{class:{chatBoxMe:"kefu"==e.mes_type}},[a("v-uni-view",{staticClass:"chatTime",class:{chatTimeHide:0==e.show_time}},[t._v(t._s(e.time))]),a("v-uni-view",{staticClass:"chatLittle"},[a("v-uni-image",{staticClass:"flyAvatar",attrs:{src:t.baseUrl+e.avator}})],1),a("v-uni-view",{staticClass:"chatBig"},[a("v-uni-view",{staticClass:"chatUser"},[t._v(t._s(e.name))]),a("v-uni-view",{staticClass:"chatContent",domProps:{innerHTML:t._s(e.content)}})],1),a("v-uni-view",{staticClass:"clear"})],1)})),1),a("v-uni-view",{staticClass:"chatBoxSend"},[a("v-uni-textarea",{staticClass:"chatArea",attrs:{placeholder:"请输入信息"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.chatToUser(e)}},model:{value:t.messageContent,callback:function(e){t.messageContent=e},expression:"messageContent"}}),a("v-uni-view",{staticClass:"btnArea"},[a("v-uni-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chatToUser.apply(void 0,arguments)}}},[t._v("发送")])],1)],1)],1)},o=[]},9585:function(t,e,a){"use strict";a("4d63"),a("ac1f"),a("25f0"),a("5319"),a("498a"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={data:function(){return{baseUrl:"https://gofly.sopans.com",wsBaseUrl:"wss://gofly.sopans.com/ws_kefu",messages:[],messageContent:"",sendDisabled:!1,token:"",visitor_id:"",kefu_name:"",isDisabled:!1,area:"",showArea:!1,scrollSize:2,faceTitles:["[微笑]","[嘻嘻]","[哈哈]","[可爱]","[可怜]","[挖鼻]","[吃惊]","[害羞]","[挤眼]","[闭嘴]","[鄙视]","[爱你]","[泪]","[偷笑]","[亲亲]","[生病]","[太开心]","[白眼]","[右哼哼]","[左哼哼]","[嘘]","[衰]","[委屈]","[吐]","[哈欠]","[抱抱]","[怒]","[疑问]","[馋嘴]","[拜拜]","[思考]","[汗]","[困]","[睡]","[钱]","[失望]","[酷]","[色]","[哼]","[鼓掌]","[晕]","[悲伤]","[抓狂]","[黑线]","[阴险]","[怒骂]","[互粉]","[心]","[伤心]","[猪头]","[熊猫]","[兔子]","[ok]","[耶]","[good]","[NO]","[赞]","[来]","[弱]","[草泥马]","[神马]","[囧]","[浮云]","[给力]","[围观]","[威武]","[奥特曼]","[礼物]","[钟]","[话筒]","[蜡烛]","[蛋糕]"]}},onLoad:function(t){var e=uni.getStorageSync("app");e&&(this.token=e.token,this.kefu_name=e.kefu_name,this.visitor_id=t.visitor_id),this.checkAuth();var a=this.baseUrl;uni.showLoading({title:"加载中..."});var n=this;uni.request({url:a+"/2/messages?visitor_id="+t.visitor_id,method:"GET",success:function(t){uni.hideLoading();var e=t.data.result;for(var a in e)e[a]["content"]=n.replaceContent(e[a]["content"],n.baseUrl);console.log(e),n.messages=e,setTimeout((function(){n.pageScrollToBottom()}),2e3),n.onlineIntime()}})},methods:{checkAuth:function(){var t=this;uni.request({url:t.baseUrl+"/userinfo?token="+t.token,method:"GET",success:function(t){var e=t.data.code;200!=e&&uni.navigateTo({url:"/pages/index/login"})}})},onlineIntime:function(){var t=this;console.log(this.wsBaseUrl+"?token="+this.token),uni.connectSocket({url:this.wsBaseUrl+"?token="+this.token}),uni.onSocketClose((function(t){console.log("WebSocket 连接断开")})),uni.onSocketOpen((function(t){console.log("WebSocket 连接已打开");var e={type:"ping",data:""};setInterval((function(){uni.sendSocketMessage({data:JSON.stringify(e)})}),5e3)})),uni.onSocketMessage((function(e){var a=JSON.parse(e.data);switch(a.type){case"message":t.recvMessage(a.data);break;case"notice":break}}))},recvMessage:function(t){var e=this;if(t.id==this.visitor_id){t.mes_type="yes"==t.is_kefu?"kefu":"visitor",t.content=e.replaceContent(t.content,e.baseUrl);var a=this.messages;a.push(t),this.messages=a,e.pageScrollToBottom()}},pageScrollToBottom:function(){this.$nextTick((function(){uni.pageScrollTo({scrollTop:1e17})}))},placeFace:function(){for(var t=[],e=0;e<this.faceTitles.length;e++)t[this.faceTitles[e]]="/static/images/face/"+e+".gif";return t},replaceContent:function(t,e){"undefined"==typeof e&&(e="");var a=this.placeFace();return t=(t||"").replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/face\[([^\s\[\]]+?)\]/g,(function(t){var n=t.replace(/^face/g,"");return'<img alt="'+n+'" title="'+n+'" src="'+e+a[n]+'">'})).replace(/img\[([^\s\[\]]+?)\]/g,(function(t){var a=t.replace(/^img\[/g,"").replace(/\]/g,"");return'<img @click="bigPic("'+e+a+'",true)" src="'+e+a+'" style="max-width: 100%"/></div>'})).replace(/file\[([^\s\[\]]+?)\]/g,(function(t){var e=t.replace(/^file\[/g,"").replace(/\]/g,"");return'<div class="folderBtn" onclick="window.open(\''+e+'\')"  style="font-size:25px;"/></div>'})).replace(/\[([^\s\[\]]+?)\]+link\[([^\s\[\]]+?)\]/g,(function(t){var e=t.replace(/link\[.*?\]/g,"").replace(/\[|\]/g,""),a=t.replace(/^\[([^\s\[\]]+?)\]+link\[/g,"").replace(/\]/g,"");return'<a href="javascript:void(0)" onclick="window.open(\''+a+"')\" />【"+e+"】</a>"})).replace(/\n/g,"<br>"),t},bigPic:function(t,e){e&&window.open(t)},chatToUser:function(){var t=this;this.messageContent=this.messageContent.trim("\r\n"),""!=this.messageContent&&"\r\n"!=this.messageContent&&""!=this.currentGuest?(uni.showLoading({title:"发送中..."}),uni.request({url:t.baseUrl+"/2/message",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded"},data:{from_id:t.kefu_name,to_id:t.visitor_id,content:t.messageContent,type:"kefu"},success:function(e){t.isDisabled=!1,uni.hideLoading();var a=e.data.code;200!=a?uni.showModal({content:e.data.msg}):(t.messageContent="",t.pageScrollToBottom())}})):uni.showModal({content:"内容不能为空"})}}};e.default=n},9913:function(t,e,a){"use strict";a.r(e);var n=a("84fd"),i=a("7fb3");for(var o in i)"default"!==o&&function(t){a.d(e,t,(function(){return i[t]}))}(o);a("d764");var s,r=a("f0c5"),c=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,"436a41d3",null,!1,n["a"],s);e["default"]=c.exports},a7f4:function(t,e,a){var n=a("bc0d");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=a("4f06").default;i("fab49e5a",n,!0,{sourceMap:!1,shadowMode:!1})},bc0d:function(t,e,a){var n=a("24fb");e=n(!1),e.push([t.i,".flyAvatar[data-v-436a41d3]{display:inline-block;box-sizing:border-box;text-align:center;color:#fff;background:#c0c4cc;width:40px;height:40px;line-height:40px;border-radius:50%;margin-top:5px}.chatUser[data-v-436a41d3]{line-height:24px;font-size:12px;white-space:nowrap;color:#999;text-align:left}.chatLittle[data-v-436a41d3]{width:12.5%;float:left}.chatBig[data-v-436a41d3]{width:87.5%;float:right}.chatBoxMe .chatContent[data-v-436a41d3]{float:right;background-color:#98e165;border:1px solid #91d760}.chatBoxMe .chatContent[data-v-436a41d3]:after{border-top-color:#98e165}.chatBoxMe .chatLittle[data-v-436a41d3]{width:12.5%;float:right;text-align:right}.chatBoxMe .chatUser[data-v-436a41d3]{text-align:right}.chatBoxMe .chatContent[data-v-436a41d3]:after{left:auto;right:-10px}.chatContent[data-v-436a41d3]{background-color:#a6d4f2;color:#000;border:1px solid #98c7e6;padding:8px 15px;word-break:break-all;position:relative;border-radius:5px;display:inline-block;margin-left:6px}.chatTime[data-v-436a41d3]{text-align:center;color:#bbb;margin:5px 0;font-size:12px}.chatArea[data-v-436a41d3]{float:left;width:70%;height:50px;margin:4px 0 0 4px;border-color:#c0c4cc;padding:1px 5px;background:#fff;border-radius:4px}.btnArea[data-v-436a41d3]{width:20%;float:right;margin-top:15px}.visitorFaceBox[data-v-436a41d3]{position:absolute;bottom:70px}.chatBoxSend[data-v-436a41d3]{background:#f5f5f5;position:fixed;bottom:0;left:0;width:100%;height:70px}.chatContext[data-v-436a41d3]{width:100%;text-align:left;position:relative;padding-bottom:70px}.clear[data-v-436a41d3]{clear:both}",""]),t.exports=e},d764:function(t,e,a){"use strict";var n=a("a7f4"),i=a.n(n);i.a}}]);