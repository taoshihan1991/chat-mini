(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-history"],{"1e90":function(t,e,n){"use strict";n.r(e);var i=n("6075"),o=n.n(i);for(var s in i)"default"!==s&&function(t){n.d(e,t,(function(){return i[t]}))}(s);e["default"]=o.a},6075:function(t,e,n){"use strict";n("99af"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={data:function(){return{title:"Hello",baseUrl:getApp().globalData.baseUrl,wsBaseUrl:getApp().globalData.wsBaseUrl,visitors:[],token:"",timer:null,wsOpen:!1,noticeContent:"",page:1}},onShow:function(){var t=uni.getStorageSync("app");console.log(t),t&&(this.token=t.token),this.checkAuth(),this.getOnlineUser(this.page)},onLoad:function(){},onPullDownRefresh:function(){console.log("refresh"),this.getOnlineUser(this.page),setTimeout((function(){uni.stopPullDownRefresh()}),1e3)},onReachBottom:function(){console.log("1"),this.page++,this.getOnlineUser(this.page)},methods:{onlineIntime:function(){var t=this,e=null;uni.connectSocket({url:this.wsBaseUrl+"?token="+this.token}),uni.onSocketClose((function(t){clearInterval(e),console.log("WebSocket 连接断开")})),uni.onSocketOpen((function(t){console.log("WebSocket 连接已打开");var n={type:"ping",data:""};e=setInterval((function(){uni.sendSocketMessage({data:JSON.stringify(n)})}),5e3)})),uni.onSocketMessage((function(e){var n=JSON.parse(e.data);switch(n.type){case"userOnline":t.showNoticeBar(n.data.username+"来了");break;case"userOffline":t.showNoticeBar(n.data.name+"离线");break}}))},getOnlineUser:function(t){var e=this,n=this.baseUrl;uni.request({url:n+"/visitors?page="+t+"&pagesize=14&token="+e.token,method:"GET",success:function(t){if(console.log(t),t.data.result.list){var n=t.data.result.list;0==e.visitors.length?e.visitors=n:e.visitors=e.visitors.concat(e.visitors,n),e.visitors=e.removeRepeat(e.visitors)}},fail:function(t){}})},chatVisitor:function(t,e){uni.navigateTo({url:"/pages/index/detail?visitor_id="+e})},showNoticeBar:function(t){var e=this;e.noticeContent=t,setTimeout((function(){e.noticeContent=""}),3e3)},checkAuth:function(){var t=this;uni.request({url:t.baseUrl+"/userinfo?token="+t.token,method:"GET",success:function(e){var n=e.data.code;200!=n?uni.navigateTo({url:"/pages/index/login"}):t.onlineIntime()}})},removeRepeat:function(t){for(var e,n=0,i=t.length,o={},s=[];n<i;n++)e=t[n].id,e=typeof e+e,o[e]||(o[e]=1,s.push(t[n]));return s}}};e.default=i},"816c":function(t,e,n){"use strict";n.r(e);var i=n("b7bf"),o=n("1e90");for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);var a,r=n("f0c5"),u=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"d65f6638",null,!1,i["a"],a);e["default"]=u.exports},b7bf:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}));var i={uniList:n("a2a1").default,uniListItem:n("3e4a").default},o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"content"},[n("uni-list",t._l(t.visitors,(function(e){return n("uni-list-item",{key:e.id,attrs:{note:e.created_at+"\n"+e.updated_at,title:e.id+"|"+e.name,thumb:t.baseUrl+e.avator,"thumb-size":"lg",clickable:!0},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.chatVisitor(n,e.visitor_id)}}})})),1),n("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:0==t.visitors.length,expression:"visitors.length==0"}],staticClass:"flyNotice"},[t._v("暂无数据")]),n("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.noticeContent,expression:"noticeContent"}],staticClass:"flyNoticeBar"},[t._v(t._s(t.noticeContent))])],1)},s=[]}}]);